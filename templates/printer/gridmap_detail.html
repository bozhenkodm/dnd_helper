<!DOCTYPE html>
<html lang="en">
<style>
.container {
  position: relative;
  text-align: center;
  overflow-x: auto; /* Enable horizontal scrolling */
  white-space: nowrap; /* Prevent wrapping inside the container */
}
table {
    border-collapse: collapse;
    border: 1px solid {{ object.grid_color }};
    background-image: url({{ object.base_image.url }});
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    width: max-content; /* Ensure the table does not shrink */
    margin: 0; /* Remove auto-centering to respect horizontal scrolling */
}

/* Фиксируем размеры ячеек и заголовков */
td, th {
    text-align: center;
    color: {{ object.grid_color }};
    vertical-align: middle;
    border: 1px solid {{ object.grid_color }};
    width: {{ object.cell_size }}px;
    height: {{ object.cell_size }}px;
    aspect-ratio: 1 / 1;
}
img {
    width: 100%;
    height: auto;
    display: block;
    margin: 0 auto;
}
</style>
<head>
    <meta charset="UTF-8">
    <title>{{ object }}</title>
</head>
<body>
{% load dict_item %}

<div class="container">
    <table>
        {% for row in object.row_range %}
            {% with col_urls=participants|dictitem:row %}
            <tr>
                {% for col in object.col_range %}
                    <td title="{{ col }}, {{ row }}" ondrop="drop(event)" ondragover="allowDrop(event)">
                        {% if col_urls %}
                            {% with urls=col_urls|dictitem:col %}
                                {% if urls %}
                                    {% with url=urls|last %}
                                        <img id="{{ url.0 }}" src="{{ url.1 }}" draggable="true" ondragstart="drag(event)">
                                    {% endwith %}
                                {% endif %}
                            {% endwith %}
                        {% endif %}
                    </td>
                {% endfor %}
            </tr>
            {% endwith %}
        {% endfor %}
    </table>
</div>
<script>
function allowDrop(event) {
    console.log("11111111111111111111111");
    event.preventDefault();
}

function drag(event) {
    console.log("22222222222222222222222");
    event.dataTransfer.setData("text", event.target.id);
}

function drop(event) {
    console.log("3333333333333333333333");
    event.preventDefault();
    const data = event.dataTransfer.getData("text");
    const draggedElement = document.getElementById(data);
    console.log(draggedElement);

    // Ensure no duplicates in the target cell
    if (event.target.tagName === 'TD' && !event.target.querySelector('img')) {
        event.target.appendChild(draggedElement);
    }
}
</script>
</body>
</html>